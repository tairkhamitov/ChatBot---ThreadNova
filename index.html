<!DOCTYPE html>
<html userLang="ru">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>–ß–∞—Ç –ø–æ–¥–¥–µ—Ä–∂–∫–∏</title>
  <link rel="stylesheet" href="style.css" />
</head>
<style>
    :root {
      --bg: #0f0f0f;
      --text: #f5f5f5;
      --accent: #ff3c00;
      --muted: #888;
    }

/* === –°–¢–ò–õ–¨ –î–õ–Ø –ß–ê–¢-–ë–û–¢–ê === */
#chatbot {
  width: 100%;
  max-width: 360px;
  background: #1a1a1a;
  border: 1px solid #333;
  border-radius: 12px;
  font-family: 'Space Grotesk', sans-serif;
  color: var(--text);
  box-shadow: 0 0 12px rgba(0,0,0,0.4);
  overflow: hidden;
  display: flex;
  flex-direction: column;
}

#chat-window {
  height: 260px;
  overflow-y: auto;
  padding: 1rem;
  background: #0f0f0f;
  border-bottom: 1px solid #333;
  scrollbar-width: none;           /* Firefox */
  -ms-overflow-style: none;  
}

#chat-window::-webkit-scrollbar {  /* Chrome, Safari */
  display: none;
}

#chat-input {
  display: flex;
  padding: 1rem;
  background: #111;
  gap: 0.5rem;
  border-top: 1px solid #333;
}

#userInput {
  flex: 1;
  padding: 0.8rem;
  border: 1px solid #333;
  border-radius: 6px;
  background: #0f0f0f;
  color: var(--text);
  font-family: 'Space Grotesk', sans-serif;
}

#chat-input button {
  background: var(--accent);
  border: none;
  padding: 0.8rem 1rem;
  color: white;
  border-radius: 6px;
  cursor: pointer;
  font-weight: bold;
}

.message {
  margin: 0.5rem 0;
  padding: 0.6rem 0.8rem;
  border-radius: 6px;
  max-width: 80%;
  word-wrap: break-word;
  font-size: 0.9rem;
}

.user {
  background: #222;
  align-self: flex-end;
  color: var(--text);
  text-align: right;
  margin-left: 40px;
}

.bot {
  background: #1a1a1a;
  align-self: flex-start;
  color: var(--text);
  text-align: left;
  border-left: 3px solid var(--accent);
}

.bot.typing {
  font-style: italic;
  color: var(--muted);
}

/* –ö–Ω–æ–ø–∫–∞ –ø–æ–≤—Ç–æ—Ä–∞ —Ç—Ä–µ–∫–∞ */
.message button {
  margin-top: 8px;
  background: var(--accent);
  border: none;
  padding: 0.5rem 1rem;
  color: white;
  border-radius: 4px;
  cursor: pointer;
  font-weight: bold;
}

</style>
<body>
  <div id="chatbot">
  <div id="chat-window">
    <div id="messages"></div>
  </div>
  <div id="chat-input">

    <input type="text" id="userInput" placeholder="Write a message..." />
    <button id="sendBtn">Send</button>
  </div>
</div>


  <script>

const badWords = {
  ru: ["–¥—É—Ä–∞–∫", "–º–∞—Ç", "–ø–ª–æ—Ö–æ–µ"],
  en: ["fuck", "shit", "idiot"],
  sk: ["debil", "sprost√Ω", "idiot"]
};

const botReplies = {
  ru: {
    answers: {
    trackingRequest: "üì¶ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä:",
    greeting: "–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ! –ß–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å?",
    farewell: "–°–ø–∞—Å–∏–±–æ –∑–∞ –æ–±—Ä–∞—â–µ–Ω–∏–µ! –•–æ—Ä–æ—à–µ–≥–æ –¥–Ω—è!",
      location: "–ú—ã –Ω–∞—Ö–æ–¥–∏–º—Å—è –≤ –°–ª–æ–≤–∞–∫–∏–∏, –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ ‚Äî –ë—Ä–∞—Ç–∏—Å–ª–∞–≤–∞. –†–∞–±–æ—Ç–∞–µ–º –ø–æ –≤—Å–µ–º—É –º–∏—Ä—É.",
      shop: "–£ –Ω–∞—Å –æ–Ω–ª–∞–π–Ω-–º–∞–≥–∞–∑–∏–Ω –∏ –ø—É–Ω–∫—Ç –≤—ã–¥–∞—á–∏ –≤ –ë—Ä–∞—Ç–∏—Å–ª–∞–≤–µ.", 
      meeting:"–î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–±—Ä–∞—Ç—å –∑–∞–∫–∞–∑ –≤ –ë—Ä–∞—Ç–∏—Å–ª–∞–≤–µ –ø–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.",
      shipping: "–î–∞, –º—ã –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–∫–∞–∑—ã –≤ –ª—é–±—É—é —Å—Ç—Ä–∞–Ω—É.", 
      shippingsng: "–î–∞, —Ä–∞–±–æ—Ç–∞–µ–º —Å–æ —Å—Ç—Ä–∞–Ω–∞–º–∏ –°–ù–ì, –¥–æ—Å—Ç–∞–≤–∫–∞ 10‚Äì25 –¥–Ω–µ–π", 
      shippingsk: "–î–æ—Å—Ç–∞–≤–∫–∞ –ø–æ –°–ª–æ–≤–∞–∫–∏–∏ –∑–∞–Ω–∏–º–∞–µ—Ç 3‚Äì7 –¥–Ω–µ–π.", 
      shippingkz: "–î–æ—Å—Ç–∞–≤–∫–∞ –≤ –ö–∞–∑–∞—Ö—Å—Ç–∞–Ω –∑–∞–Ω–∏–º–∞–µ—Ç 10‚Äì25 –¥–Ω–µ–π.", 
      shippingmethod:"–í –ï–≤—Ä–æ–ø–µ: DPD, GLS, UPS. –í –°–ù–ì: Slovensk√° po≈°ta, DHL Express.", 
      dhlexpress:"–î–∞, –ø–æ –∑–∞–ø—Ä–æ—Å—É –º—ã –º–æ–∂–µ–º –æ—Ç–ø—Ä–∞–≤–∏—Ç—å DHL Express.", 
      freeshipping:"–°—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏ —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏, –±–µ—Å–ø–ª–∞—Ç–Ω–æ–π –¥–æ—Å—Ç–∞–≤–∫–∏ –Ω–µ—Ç.", 
      selfpickup:"–î–∞, —Å–∞–º–æ–≤—ã–≤–æ–∑ –¥–æ—Å—Ç—É–ø–µ–Ω –≤ –ë—Ä–∞—Ç–∏—Å–ª–∞–≤–µ –ø–æ –¥–æ–≥–æ–≤–æ—Ä–µ–Ω–Ω–æ—Å—Ç–∏.", 
      payment: "–ü—Ä–∏–Ω–∏–º–∞–µ–º –∫–∞—Ä—Ç—ã (Visa, MasterCard), PayPal, –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É, –±–∞–Ω–∫–æ–≤—Å–∫–∏–π –ø–µ—Ä–µ–≤–æ–¥ (SEPA & SWIFT). –°–≤—è–∂–∏—Ç–µ—Å—å —Å –Ω–∞—à–∏–º –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º, –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∞–Ω–Ω–æ–π –æ–ø–µ—Ä–∞—Ü–∏–∏", 
      paypal:"–î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –æ–ø–ª–∞—Ç–∏—Ç—å –∑–∞–∫–∞–∑ —á–µ—Ä–µ–∑ PayPal.", 
      cryptocurrency:"–î–∞, –º—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º –∫—Ä–∏–ø—Ç–æ–≤–∞–ª—é—Ç—É –ø–æ –∑–∞–ø—Ä–æ—Å—É.", 
      ruscard:"–î–∞, —Ä–æ—Å—Å–∏–π—Å–∫–∏–µ –∫–∞—Ä—Ç—ã –ø—Ä–∏–Ω–∏–º–∞—é—Ç—Å—è –ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.", 
      fees:"–î–∞, –ø–æ—à–ª–∏–Ω—ã –∑–∞–≤–∏—Å—è—Ç –æ—Ç —Å—Ç—Ä–∞–Ω—ã –∏ –æ–ø–ª–∞—á–∏–≤–∞—é—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–æ–º.", 
      products:"–ú—ã –ø—Ä–æ–¥–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—É—é –æ–¥–µ–∂–¥—É –∏ –∞–∫—Å–µ—Å—Å—É–∞—Ä—ã, —Ç–∞–∫–∂–µ –¥–µ–ª–∞–µ–º –±—Ä–µ–Ω–¥–∏–Ω–≥.", 
      custom: "–î–∞! –û—Ç–ø—Ä–∞–≤—å—Ç–µ –≤–∞—à —ç—Å–∫–∏–∑ –∏–ª–∏ –∏–¥–µ—é, –∏ –º—ã —Å–¥–µ–ª–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–π –¥–∏–∑–∞–π–Ω.", 
      branding:"–î–∞, –º—ã –¥–µ–ª–∞–µ–º –ª–æ–≥–æ—Ç–∏–ø—ã, —É–ø–∞–∫–æ–≤–∫—É, —Å—Ç–∏–∫–µ—Ä—ã –∏ –¥—Ä—É–≥–æ–µ.", 
      sale:"–î–∞, –º—ã –ø—Ä–µ–¥–ª–∞–≥–∞–µ–º —Å–∫–∏–¥–∫–∏ –Ω–∞ –æ–ø—Ç–æ–≤—ã–µ –∑–∞–∫–∞–∑—ã.", 
      return: "–ù–∞–ø–∏—à–∏—Ç–µ –Ω–∞–º –Ω–∞ email –∏ –ø—Ä–∏–ª–æ–∂–∏—Ç–µ —Ñ–æ—Ç–æ —Ç–æ–≤–∞—Ä–∞.", 
      returnbrand:"–ù–µ—Ç, –≤–æ–∑–≤—Ä–∞—Ç –∫–∞—Å—Ç–æ–º–Ω–æ–π –æ–¥–µ–∂–¥—ã –≤–æ–∑–º–æ–∂–µ–Ω —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –±—Ä–∞–∫–µ.", 
      care: "–°—Ç–∏—Ä–∞—Ç—å –ø—Ä–∏ 30¬∞C, –≥–ª–∞–¥–∏—Ç—å –Ω–∞–∏–∑–Ω–∞–Ω–∫—É, –Ω–µ –æ—Ç–±–µ–ª–∏–≤–∞—Ç—å.",
      contact: "–í—ã –º–æ–∂–µ—Ç–µ –Ω–∞–ø–∏—Å–∞—Ç—å –Ω–∞–º –Ω–∞ email –∏–ª–∏ Telegram. Email: threadnova.custom@gmail.com, Telegram: @ThreadNova_bot", 
      wholesale: "–î–∞, –º—ã –ø—Ä–∏–Ω–∏–º–∞–µ–º –∑–∞–∫–∞–∑—ã –æ–ø—Ç–æ–º –∏ –≤ —Ä–æ–∑–Ω–∏—Ü—É. –ù–∞–ø–∏—à–∏—Ç–µ –∂–µ–ª–∞–µ–º–æ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∏ –º–æ–¥–µ–ª—å.", 
      instagram:"–î–∞, –Ω–∞—à Instagram: @thread.nova.", 
      tracking:"–ü–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –º—ã –≤—ã—à–ª–µ–º –≤–∞–º —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è.", 
      shipcost:"–°—Ç–æ–∏–º–æ—Å—Ç—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –æ—Ç–ø—Ä–∞–≤–∫–∏ –∑–∞—è–≤–∫–∏, –º–µ–Ω–µ–¥–∂–µ—Ä –ø–æ—Å—á–∏—Ç–∞–µ—Ç –∏ –æ—Ç–ø—Ä–∞–≤–∏—Ç –≤–∞–º –∫–æ–Ω–µ—á–Ω—É—é —Å—Ç–æ–∏–º–æ—Å—Ç—å.", 
      cash:"–ù–µ—Ç, –Ω–∞–ª–æ–∂–µ–Ω–Ω—ã–π –ø–ª–∞—Ç–µ–∂ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω.", 
      prepayment:"–ú—ã —Ä–∞–±–æ—Ç–∞–µ–º –ø–æ 100% –ø—Ä–µ–¥–æ–ø–ª–∞—Ç–µ, —Ä–∞—Å—Å—Ä–æ—á–∫–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.",
      appleorgoogle:"–î–∞, –ø—Ä–∏ –æ–ø–ª–∞—Ç–µ —á–µ—Ä–µ–∑ PayPal –≤—ã –º–æ–∂–µ—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —ç—Ç–∏ —Å–µ—Ä–≤–∏—Å—ã.", 
      taxes:"–≠—Ç–æ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∑–∞–∫–æ–Ω–æ–≤ –≤–∞—à–µ–π —Å—Ç—Ä–∞–Ω—ã. –ú—ã –Ω–µ –º–æ–∂–µ–º –∑–∞—Ä–∞–Ω–µ–µ —É–∫–∞–∑–∞—Ç—å —Ç–æ—á–Ω—É—é —Å—É–º–º—É.", 
      logo:"–î–∞, –º—ã –¥–µ–ª–∞–µ–º –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω—ã–µ –∑–∞–∫–∞–∑—ã —Å –ª–æ–≥–æ—Ç–∏–ø–∞–º–∏.", 
      material:"–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º –∫–∞—á–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Ç–∫–∞–Ω–∏: —Ö–ª–æ–ø–æ–∫, –ø–æ–ª–∏—ç—Å—Ç–µ—Ä, —Ç—Ä–∏–∫–æ—Ç–∞–∂.", 
      katalog:"–î–∞, —É –Ω–∞—Å –µ—Å—Ç—å –∫–∞—Ç–∞–ª–æ–≥ –≥–æ—Ç–æ–≤–æ–π –ø—Ä–æ–¥—É–∫—Ü–∏–∏ –∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –æ–ø—Ü–∏–π.", 
      wholesalemin:"–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –æ–ø—Ç–æ–≤—ã–π –∑–∞–∫–∞–∑ ‚Äî 20 –µ–¥–∏–Ω–∏—Ü.", 
      sample:"–î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –∑–∞–∫–∞–∑–∞—Ç—å –æ–¥–∏–Ω –æ–±—Ä–∞–∑–µ—Ü –ø–µ—Ä–µ–¥ –æ–ø—Ç–æ–≤–æ–π –ø–∞—Ä—Ç–∏–µ–π.", 
      returnday:"–ö–∞—Ç–∞–ª–æ–∂–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å –≤ —Ç–µ—á–µ–Ω–∏–µ 14 –¥–Ω–µ–π.", 
      returnpay:"–î–æ—Å—Ç–∞–≤–∫–∞ –æ–ø–ª–∞—á–∏–≤–∞–µ—Ç—Å—è –∫–ª–∏–µ–Ω—Ç–æ–º, –∫—Ä–æ–º–µ —Å–ª—É—á–∞–µ–≤ –±—Ä–∞–∫–∞.", 
      iron:"–î–∞, –≥–ª–∞–¥–∏—Ç—å —Ç–æ–ª—å–∫–æ –Ω–∞–∏–∑–Ω–∞–Ω–∫—É.", 
      degree:"–ù–µ—Ç, –º–∞–∫—Å–∏–º—É–º 30¬∞C.", 
      bleach:"–ù–µ—Ç, –æ—Ç–±–µ–ª–∏–≤–∞–Ω–∏–µ –∑–∞–ø—Ä–µ—â–µ–Ω–æ.", 
      telegrambot:"–î–∞, –Ω–∞—à Telegram: @ThreadNova_bot.", 
      website:"–î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑ –Ω–∞ —Å–∞–π—Ç–µ.", 
      email:"–î–∞, –Ω–∞—à email: thread.novacustom@gmail.com.", 
      whatsapp:"–î–∞, –ø–æ –∑–∞–ø—Ä–æ—Å—É –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–∏–º –Ω–æ–º–µ—Ä.", 
      preorder:"–î–∞, –≤—ã –º–æ–∂–µ—Ç–µ –æ—Ñ–æ—Ä–º–∏—Ç—å –ø—Ä–µ–¥–∑–∞–∫–∞–∑ –Ω–∞ –±—É–¥—É—â–∏–µ –∫–æ–ª–ª–µ–∫—Ü–∏–∏.", 
      loyalty:"–î–∞, –¥–ª—è –ø–æ—Å—Ç–æ—è–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —É –Ω–∞—Å –¥–µ–π—Å—Ç–≤—É—é—Ç —Å–∫–∏–¥–∫–∏.", 
      unknown: "–ù–µ —Å–æ–≤—Å–µ–º –ø–æ–Ω—è–ª. –ù–∞–ø–∏—à–∏—Ç–µ –ø–æ–¥—Ä–æ–±–Ω–µ–µ –∏–ª–∏ —Å–≤—è–∂–∏—Ç–µ—Å—å —Å –º–µ–Ω–µ–¥–∂–µ—Ä–æ–º. thread.novacustom@gmail.com"
    }
  },
  en: {
    answers: {
    trackingRequest: "üì¶ Please enter your tracking number:",
    greeting: "Hello! How can I help you?",
    farewell: "Thank you! Have a great day!",
      location: "We are based in Slovakia, with a pickup point in Bratislava. We work worldwide.",
      shop: "We have an online store and a pickup point in Bratislava.",
      meeting:"Yes, you can pick up your order in Bratislava by appointment.",
      shipping: "Yes, we ship to any country.",
      shippingsng: "Yes, we work with CIS countries, delivery takes 10‚Äì25 days.",
      shippingsk: "Delivery within Slovakia takes 3‚Äì7 days.",
      shippingkz: "Shipping to Kazakhstan takes 10‚Äì25 days.",
      shippingmethod:"Within Europe: DPD, GLS, UPS. To CIS countries: Slovensk√° po≈°ta, DHL Express.",
      dhlexpress:"Yes, we can ship with DHL Express upon request.",
      freeshipping:"Shipping costs are calculated automatically, there is no free shipping.",
      selfpickup:"Yes, pickup is available in Bratislava by appointment.",
      payment: "We accept cards (Visa, MasterCard), PayPal, cryptocurrency, bank transfer (SEPA & SWIFT). Contact our manager to complete this transaction.",
      paypal:"Yes, you can pay via PayPal.",
      cryptocurrency:"Yes, we accept cryptocurrency upon request.",
      ruscard:"Yes, Russian cards are accepted upon confirmation.",
      fees:"Yes, customs fees depend on your country and are the customer's responsibility.",
      products:"We sell custom clothing and accessories, and also offer branding services.",
      custom: "Yes! Send us your sketch or idea, and we‚Äôll create your custom design.",
      branding:"Yes, we provide logos, packaging, stickers, and more.",
      sale:"Yes, we provide discounts for wholesale orders.",
      return: "Email us and attach a photo of the item.",
      returnbrand:"No, custom-made clothing can only be returned if defective.",
      care: "Wash at max 30¬∞C, iron inside out, do not bleach.",
      contact: "You can contact us via email or Telegram. Email: threadnova.custom@gmail.com, Telegram: @ThreadNova_bot",
      wholesale: "Yes, we accept both retail and wholesale orders. Send your quantity and model.",
      instagram:"Yes, our Instagram is @thread.nova.",
      tracking:"After shipping, we will send you a tracking number.",
      shipcost:"The cost is calculated after you submit your request. The manager will calculate it and send you the final cost.",
      cash:"No, cash on delivery is not available.",
      prepayment:"We require 100% prepayment, no installments available.",
      appleorgoogle:"Yes, you can use them via PayPal.",
      taxes:"It depends on your country‚Äôs regulations. We can‚Äôt provide an exact amount in advance.",
      logo:"Yes, we create corporate orders with logos.",
      material:"We use high-quality fabrics: cotton, polyester, knitwear.",
      katalog:"Yes, we have a catalog of ready-made and custom options.",
      wholesalemin:"The minimum wholesale order is 20 units.",
      sample:"Yes, you can order one sample before the wholesale batch.",
      returnday:"Catalog items can be returned within 14 days.",
      returnpay:"The customer pays for return shipping unless the item is defective.",
      iron:"Yes, iron inside out only.",
      degree:"No, max 30¬∞C.",
      bleach:"No, do not use bleach.",
      telegrambot:"Yes, our Telegram is @ThreadNova_bot.",
      website:"Yes, you can place an order on our website.",
      email:"Yes, our email is thread.novacustom@gmail.com.",
      whatsapp:"Yes, we can provide a number upon request.",
      preorder:"Yes, you can place a pre-order for upcoming collections.",
      loyalty:"Yes, we offer discounts for returning customers.",
      unknown: "I didn‚Äôt quite get that. Please clarify or contact our manager. thread.novacustom@gmail.com"
    }
  },
  sk: {
    answers: {
    trackingRequest: "üì¶ Zadajte svoje sledovacie ƒç√≠slo:",
    greeting: "Dobr√Ω de≈à! Ako v√°m m√¥≈æem pom√¥c≈•?",
    farewell: "ƒéakujeme! Prajeme pekn√Ω de≈à!",
      location: "S√≠dlime na Slovensku, odbern√© miesto m√°me v Bratislave. Spolupracujeme s klientmi po celom svete.",
      shop: "M√°me online obchod a odbern√© miesto v Bratislave.",
      meeting:"√Åno, m√¥≈æete si vyzdvihn√∫≈• objedn√°vku v Bratislave po dohode.",
      shipping: "√Åno, posielame objedn√°vky do ka≈ædej krajiny.",
      shippingsng: "√Åno, pracujeme s krajinami SN≈†, doruƒçenie trv√° 10‚Äì25 dn√≠.",
      shippingsk: "Doruƒçenie na Slovensku trv√° 3‚Äì7 dn√≠.",
      shippingkz: "Doruƒçenie do Kazachstanu trv√° 10‚Äì25 dn√≠.",
      shippingmethod:"V Eur√≥pe: DPD, GLS, UPS. Do SN≈†: Slovensk√° po≈°ta, DHL Express.",
      dhlexpress:"√Åno, na po≈æiadanie m√¥≈æeme posla≈• cez DHL Express.",
      freeshipping:"Cena doruƒçenia sa poƒç√≠ta automaticky, doprava zadarmo nie je.",
      selfpickup:"√Åno, osobn√Ω odber je mo≈æn√Ω v Bratislave po dohode.",
      payment: "Prij√≠mame karty (Visa, MasterCard), PayPal, kryptomenu, bankov√Ω prevod (SEPA & SWIFT). Kontaktujte n√°≈°ho mana≈æ√©ra, aby ste dokonƒçili t√∫to oper√°ciu.",
      paypal:"√Åno, m√¥≈æete zaplati≈• cez PayPal.",
      cryptocurrency:"√Åno, prij√≠mame kryptomeny na po≈æiadanie.",
      ruscard:"√Åno, rusk√© karty s√∫ akceptovan√© po potvrden√≠.",
      fees:"√Åno, poplatky z√°visia od krajiny a plat√≠ ich z√°kazn√≠k.",
      products:"Pred√°vame personalizovan√© obleƒçenie a doplnky, tie≈æ pon√∫kame branding.",
      custom: "√Åno! Po≈°lite n√°m svoj n√°vrh alebo n√°pad a vytvor√≠me v√°m personalizovan√Ω dizajn.",
      branding:"√Åno, poskytujeme log√°, balenie, n√°lepky a ƒèal≈°ie.",
      sale:"√Åno, poskytujeme zƒæavy na veƒækoobchodn√© objedn√°vky.",
      return: "Nap√≠≈°te n√°m e-mail a prilo≈æte fotografiu produktu.",
      returnbrand:"Nie, vr√°tenie personalizovan√©ho obleƒçenia je mo≈æn√© len pri chybe.",
      care: "Pra≈• pri max. 30¬∞C, ≈æehli≈• naruby, nebieli≈•.",
      contact: "M√¥≈æete n√°s kontaktova≈• e-mailom alebo cez Telegram. Email: threadnova.custom@gmail.com, Telegram: @ThreadNova_bot",
      wholesale: "√Åno, prij√≠mame objedn√°vky veƒækoobchodne aj maloobchodne.",
      instagram:"√Åno, n√°≈° Instagram je @thread.nova.",
      tracking:"Po odoslan√≠ v√°m po≈°leme sledovacie ƒç√≠slo.",
      shipcost:"Cena sa vypoƒç√≠ta po odoslan√≠ ≈æiadosti, mana≈æ√©r ju vypoƒç√≠ta a za≈°le v√°m koneƒçn√∫ cenu.",
      cash:"Nie, platba na dobierku nie je dostupn√°.",
      prepayment:"Vy≈æadujeme 100% platbu vopred, spl√°tky nie s√∫ dostupn√©.",
      appleorgoogle:"√Åno, m√¥≈æete ich pou≈æi≈• cez PayPal.",
      taxes:"Z√°vis√≠ to od z√°konov va≈°ej krajiny. Nem√¥≈æeme uvies≈• presn√∫ sumu vopred.",
      logo:"√Åno, rob√≠me firemn√© objedn√°vky s logami.",
      material:"Pou≈æ√≠vame kvalitn√© l√°tky: bavlna, polyester, √∫plet.",
      katalog:"√Åno, m√°me katal√≥g hotov√Ωch produktov a personalizovan√Ωch mo≈ænost√≠.",
      wholesalemin:"Minim√°lna veƒækoobchodn√° objedn√°vka je 20 kusov.",
      sample:"√Åno, m√¥≈æete si objedna≈• jednu vzorku pred veƒæk√Ωm mno≈æstvom.",
      returnday:"Katal√≥gov√© produkty m√¥≈æete vr√°ti≈• do 14 dn√≠.",
      returnpay:"Z√°kazn√≠k plat√≠ po≈°tovn√© pri vr√°ten√≠, okrem pr√≠padov chyby.",
      iron:"√Åno, ≈æehli≈• len naruby.",
      degree:"Nie, maximum je 30¬∞C.",
      bleach:"Nie, nebieli≈•.",
      telegrambot:"√Åno, n√°≈° Telegram je @ThreadNova_bot.",
      website:"√Åno, m√¥≈æete objedna≈• cez na≈°u webov√∫ str√°nku.",
      email:"√Åno, n√°≈° e-mail je thread.novacustom@gmail.com.",
      whatsapp:"√Åno, m√¥≈æeme poskytn√∫≈• ƒç√≠slo na po≈æiadanie.",
      preorder:"√Åno, m√¥≈æete si urobi≈• predobjedn√°vku na bud√∫ce kolekcie.",
      loyalty:"√Åno, pon√∫kame zƒæavy pre st√°lych z√°kazn√≠kov.",
      unknown: "Nerozumel som. Pros√≠m, uveƒète viac alebo kontaktujte mana≈æ√©ra. thread.novacustom@gmail.com"
      
    }
  }
};
function preprocess(text) {
  // 1. –ü—Ä–∏–≤–µ—Å—Ç–∏ –∫ –Ω–∏–∂–Ω–µ–º—É —Ä–µ–≥–∏—Å—Ç—Ä—É
  text = text.toLowerCase();

  // 2. –£–¥–∞–ª–∏—Ç—å –∑–Ω–∞–∫–∏ –ø—Ä–µ–ø–∏–Ω–∞–Ω–∏—è
  text = text.replace(/[.,!?;:()"]/g, '');

  // 3. –£–¥–∞–ª–∏—Ç—å —Å—Ç–æ–ø-—Å–ª–æ–≤–∞
  const stopWords = ['–Ω—É', '–∞', '–∏', '–∂–µ', '–≤–æ—Ç', '–ø–æ–∂–∞–ª—É–π—Å—Ç–∞', '—Å–∫–∞–∂–∏—Ç–µ', '–º–æ–∂–Ω–æ', '–ª–∏', '–≤—ã'];
  stopWords.forEach(word => {
    const regex = new RegExp('\\b' + word + '\\b', 'gi');
    text = text.replace(regex, '');
  });

  // 4. –£–¥–∞–ª–∏—Ç—å –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã
  text = text.trim().replace(/\s+/g, ' ');

  return text;
}
  const intents = [
    {
      name: "trackingRequest",
      patterns: [
        // RU
        "–≥–¥–µ –º–æ–π –∑–∞–∫–∞–∑", "–æ—Ç—Å–ª–µ–¥–∏—Ç—å –∑–∞–∫–∞–∑", "—Ö–æ—á—É –æ—Ç—Å–ª–µ–¥–∏—Ç—å", "–æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ", "—Ç—Ä–µ–∫ –Ω–æ–º–µ—Ä", "—Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä", "—Ç—Ä–µ–∫–Ω–æ–º–µ—Ä",
        "–Ω–æ–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–∏—è", "–Ω–æ–º–µ—Ä –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è", "—É–∑–Ω–∞—Ç—å —Å—Ç–∞—Ç—É—Å", "–∫–æ–≥–¥–∞ –ø—Ä–∏–¥–µ—Ç –∑–∞–∫–∞–∑", "—Å—Ç–∞—Ç—É—Å –¥–æ—Å—Ç–∞–≤–∫–∏",
        // EN
        "where is my order", "track my order", "tracking number", "order status", "track shipment", "track package",
        "delivery status", "check my order", "shipment number",
        // SK
        "kde je moja objedn√°vka", "sledova≈• objedn√°vku", "sledovacie ƒç√≠slo", "stav objedn√°vky", "sledovanie z√°sielky",
        "kde je bal√≠k", "ƒç√≠slo z√°sielky", "overi≈• objedn√°vku"
      ],
      responseKey: "trackingRequest"
    },
    { name: "greeting", patterns: ["–ø—Ä–∏–≤", "hi", "ahoj", "–∑–¥–∞—Ä–æ–≤", "hello", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ", "good morning", "dobr√Ω de≈à"], responseKey: "greeting" },
    { name: "location", patterns: ["–∞–¥—Ä–µ—Å", "address", "adresu", "–Ω–∞—Ö–æ–¥–∏—Ç", "base", "nach√°dzate", "–ª–æ–∫–∞—Ü–∏—è", "locat", "lokalizova≈•"], responseKey: "location" },
    { name: "shop", patterns: ["—Ñ–∏–∑–∏—á–µ—Å", "physic", "obchod", "–æ–Ω–ª–∞–π–Ω", "online"], responseKey: "shop" },
    { name: "meeting", patterns: ["–ª–∏—á–Ω–æ", "in person", "osobne"], responseKey: "meeting" },
    { 
      name: "shipping", 
      patterns: [
        "–≤—Å–µ–º—É –º–∏—Ä—É", "worldwide", "celom svete", 
        "—Å—Ç—Ä–∞–Ω—ã", "countries", "krajiny", 
        "–∫—É–¥–∞", "wherever", "kam", 
        "–¥–æ—Å—Ç–∞–≤–∫–∞", "–æ—Ç–ø—Ä–∞–≤–∫–∞", "–æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç–µ", "–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç–µ"
      ], 
      responseKey: "shipping" 
    },
    { name: "shippingsng", patterns: ["–∏–∑ –∫–∞–∑–∞—Ö—Å—Ç–∞–Ω–∞", "from kazakhstan", "z kazachstanu", "–∏–∑ —É–∫—Ä–∞–∏–Ω—ã", "from ukraine", "z ukrajiny", "–∏–∑ —Ä–æ—Å—Å–∏–∏", "from russia", "z ruzka"], responseKey: "shippingsng" },
    { name: "shippingsk", patterns: ["—Å–ª–æ–≤–∞–∫", "slovak", "slovensk"], responseKey: "shippingsk" },
    { name: "shippingkz", patterns: ["–≤ –∫–∞–∑–∞—Ö—Å—Ç–∞–Ω", "to kazakhstan", "do kazachstanu"], responseKey: "shippingkz" },
    { name: "shippingmethod", patterns: ["—Å–ª—É–∂–±–∞ –¥–æ—Å—Ç–∞–≤–∫–∏", "shipping carrier", "doruƒçovacia slu≈æba", "—Å–ª—É–∂–±—É –¥–æ—Å—Ç–∞–≤–∫–∏", "shipping method", "doruƒçovacia slu≈æby", "—Å–ª—É–∂–±—ã –¥–æ—Å—Ç–∞–≤–∫–∏", "doruƒçovacia slu≈æbi"], responseKey: "shippingmethod" },
    { name: "dhlexpress", patterns: ["dhl", "–±—ã—Å—Ç—Ä", "fast", "r√Ωchl"], responseKey: "dhlexpress" },
    { name: "freeshipping", patterns: ["–±–µ—Å–ø–ª–∞—Ç–Ω", "free", "zadarm"], responseKey: "freeshipping" },
    { name: "selfpickup", patterns: ["—Å–∞–º–æ–≤—ã–≤–æ–∑", "myself", "samov√Ωvoz"], responseKey: "selfpickup" },
    { name: "payment", patterns: ["—Å–ø–æ—Å–æ–± –æ–ø–ª–∞—Ç—ã", "—Å–ø–æ—Å–æ–±—ã –æ–ø–ª–∞—Ç—ã", "payment method", "sp√¥sob platby", "sp√¥soby platby", "–æ–ø–ª–∞—Ç–∞", "–æ–ø–ª–∞—Ç–∏—Ç—å", "–∫–∞—Ä—Ç–∞", "–∫–∞—Ä—Ç–æ–π", "visa", "mastercard"], responseKey: "payment" },
    { name: "paypal", patterns: ["paypal"], responseKey: "paypal" },
    { name: "cryptocurrency", patterns: ["–∫—Ä–∏–ø—Ç", "crypt", "krypt"], responseKey: "cryptocurrency" },
    { name: "ruscard", patterns: ["–∫–∞—Ä—Ç–æ–π –∏–∑ —Ä–æ—Å—Å–∏–∏", "—Ä–æ—Å—Å–∏—Å–∫–æ–π –∫–∞—Ä—Ç–æ–π", "russian card", "rusk√° karta", "rusk√© karty"], responseKey: "ruscard" },
    { name: "fees", patterns: ["—Ç–∞–º–æ–∂", "fee", "poplatok", "–ø–æ—à–ª–∏–Ω", "poplatky"], responseKey: "fees" },
    { name: "products", patterns: ["—Ç–æ–≤–∞—Ä", "product", "produkt"], responseKey: "products" },
    { name: "custom", patterns: ["—Å–≤–æ–π –¥–∏–∑–∞–π–Ω", "own design", "vlastn√Ω dizajn"], responseKey: "custom" },
    { name: "branding", patterns: ["–±—Ä–µ–Ω–¥–∏—Ä–æ–≤–∞–Ω", "branding", "brandingov√©"], responseKey: "branding" },
    { name: "sale", patterns: ["—Å–∫–∏–¥–∫", "discount", "zƒæav"], responseKey: "sale" },
    { name: "return", patterns: ["–≤–µ—Ä–Ω—É", "–≤–æ–∑–≤—Ä–∞—Ç", "return", "vr√°ti≈•"], responseKey: "return" },
    { name: "returnbrand", patterns: ["–≤–µ—Ä–Ω—É—Ç—å –∫–∞—Å—Ç–æ–º", "–≤–æ–∑–≤—Ä–∞—Ç –∫–∞—Å—Ç–æ–º", "return custom", "vr√°ti≈• vlastn√©", "vr√°tenie z√°kazkov√©ho"], responseKey: "returnbrand" },
    { name: "wholesale", patterns: ["–æ–ø—Ç–æ–º", "–æ–ø—Ç–æ–≤", "wholesale", "veƒækoobchod"], responseKey: "wholesale" },
    { name: "care", patterns: ["—É—Ö–∞–∂", "—É—Ö–æ–¥", "care", "caring", "stara≈•", "starostlivos≈•"], responseKey: "care" },
    { name: "contact", patterns: ["—Å–≤—è–∑", "contact", "kontakt"], responseKey: "contact" },
    { name: "instagram", patterns: ["instagram", "–∏–Ω—Å—Ç–∞–≥—Ä–∞–º"], responseKey: "instagram" },
    { name: "tracking", patterns: ["—Ç—Ä–µ–∫", "track", "sledovacie", "–º–æ–π –∑–∞–∫–∞–∑", "my order", "moja objedn√°vka"], responseKey: "tracking" },
    {
      name: "shipcost",
      patterns: [
        "—Å—Ç–æ–∏—Ç –¥–æ—Å—Ç–∞–≤–∫–∞", "—Ü–µ–Ω–∞ –¥–æ—Å—Ç–∞–≤–∫", "—Å—Ç–æ–∏–º–æ—Å—Ç—å –¥–æ—Å—Ç–∞–≤–∫–∏", 
        "—Å–∫–æ–ª—å–∫–æ —Å—Ç–æ–∏—Ç", "—Å–∫–æ–ª—å–∫–æ –¥–æ—Å—Ç–∞–≤–∫–∞", "—Å–∫–æ–ª—å–∫–æ", 
        "shipping cost", "cost of the shipping", 
        "how much", "cena dopravy", "stoj√≠ doprava"
      ],
      responseKey: "shipcost"
    },
    { name: "cash", patterns: ["–Ω–∞–ª–∏—á", "–Ω–∞–ª–æ–º", "cash", "hotovos≈•", "dobierk"], responseKey: "cash" },
    { name: "prepayment", patterns: ["—Ä–∞—Å—Å—Ä–æ—á–∫", "–ø—Ä–µ–¥–æ–ø–ª–∞—Ç", "partial", "installment", "spl√°tk", "predplatb"], responseKey: "prepayment" },
    { name: "appleorgoogle", patterns: ["apple pay", "google pay", "—ç–ø–ª –ø—ç–π", "–≥—É–≥–ª –ø—ç–π"], responseKey: "appleorgoogle" },
    { name: "taxes", patterns: ["–Ω–∞–ª–æ–≥", "tax", "dane"], responseKey: "taxes" },
    { name: "logo", patterns: ["–ª–æ–≥–æ", "logo"], responseKey: "logo" },
    { name: "material", patterns: ["–º–∞—Ç–µ—Ä–∏–∞–ª", "material", "materi√°l"], responseKey: "material" },
    { name: "katalog", patterns: ["–∫–∞—Ç–∞–ª–æ–≥", "catalog", "katal√≥g"], responseKey: "katalog" },
    { name: "wholesalemin", patterns: ["–º–∏–Ω–∏–º–∞–ª", "minimum", "minim√°l"], responseKey: "wholesalemin" },
    { name: "sample", patterns: ["–æ–±—Ä–∞–∑", "sample", "vzork"], responseKey: "sample" },
    { name: "returnday", patterns: ["–¥–Ω–µ–π –Ω–∞ –≤–æ–∑–≤—Ä–∞—Ç", "days to return", "dni na vr√°tenie"], responseKey: "returnday" },
    { name: "returnpay", patterns: ["–æ–ø–ª–∞—á–∏–≤–∞–µ—Ç –≤–æ–∑–≤—Ä–∞—Ç", "pays for return", "plat√≠ za vr√°tenie"], responseKey: "returnpay" },
    { name: "iron", patterns: ["–≥–ª–∞–¥–∏—Ç", "—É—Ç—é–≥", "iron", "≈æehli≈•", "≈æehliƒçk"], responseKey: "iron" },
    { name: "degree", patterns: ["—Å—Ç–∏—Ä–∞—Ç—å", "–≥—Ä–∞–¥—É—Å", "wash", "degree", "pra≈•", "stup≈à"], responseKey: "degree" },
    { name: "bleach", patterns: ["–±–µ–ª–∏–∑–Ω", "bleach", "bielidlo"], responseKey: "bleach" },
    { name: "telegrambot", patterns: ["telegram", "—Ç–µ–ª–µ–≥—Ä–∞–º"], responseKey: "telegrambot" },
    { name: "website", patterns: ["—Å–∞–π—Ç", "website", "webov"], responseKey: "website" },
    { name: "email", patterns: ["–º–µ–π–ª", "email", "mail"], responseKey: "email" },
    { name: "whatsapp", patterns: ["whatsapp", "–≤–∞—Ç—Å", "wattsapp"], responseKey: "whatsapp" },
    { name: "preorder", patterns: ["–ø—Ä–µ–¥–∑–∞–∫–∞–∑", "preorder", "predobjedn√°vk"], responseKey: "preorder" },
    { name: "loyalty", patterns: ["–ª–æ—è–ª—å", "loyal", "vernost"], responseKey: "loyalty" },
    { name: "farewell", patterns: ["–ø–æ–∫–∞", "–ø—Ä–æ—â–∞–π", "bye", "goodbye", "dovy", "do videnia"], responseKey: "farewell" },
    { name: "unknown", patterns: [], responseKey: "unknown" }
  ];

  let lastUserMessage = "";
  let lastIntent = null;
  let userLang = null;
  function intentTitleRu(key) {
    const titles = {
      shipping: "–î–æ—Å—Ç–∞–≤–∫–∞", payment: "–û–ø–ª–∞—Ç–∞", location: "–ê–¥—Ä–µ—Å", products: "–¢–æ–≤–∞—Ä—ã",
      custom: "–ö–∞—Å—Ç–æ–º", branding: "–ë—Ä–µ–Ω–¥–∏–Ω–≥", fees: "–ü–æ—à–ª–∏–Ω—ã", return: "–í–æ–∑–≤—Ä–∞—Ç",
      contact: "–ö–æ–Ω—Ç–∞–∫—Ç—ã", tracking: "–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ", katalog: "–ö–∞—Ç–∞–ª–æ–≥", 
      // –î–æ–±–∞–≤—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∫–ª—é—á–∏, –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
    };
    return titles[key] || key;
  }

  function intentTitleEn(key) {
    const titles = {
      shipping: "Shipping", payment: "Payment", location: "Location", products: "Products",
      custom: "Custom Design", branding: "Branding", fees: "Fees", return: "Returns",
      contact: "Contact", tracking: "Tracking", katalog: "Catalog",
    };
    return titles[key] || key;
  }

  function intentTitleSk(key) {
    const titles = {
      shipping: "Doruƒçenie", payment: "Platba", location: "Adresa", products: "Produkty",
      custom: "Vlastn√Ω Dizajn", branding: "Branding", fees: "Poplatky", return: "Vr√°tenie",
      contact: "Kontakt", tracking: "Sledovanie", katalog: "Katal√≥g",
    };
    return titles[key] || key;
  }

  const languageKeywords = {
    ru: [
  "–ø—Ä–∏–≤", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ", "–¥–æ—Å—Ç–∞–≤–∫–∞", "–æ–ø–ª–∞—Ç–∞", "—Ç–æ–≤–∞—Ä", "–∞–¥—Ä–µ—Å", "–∫–∞—Ä—Ç–∞",
  "–≥–¥–µ", "–º–æ–π", "–∑–∞–∫–∞–∑", "—Ç—Ä–µ–∫", "–Ω–æ–º–µ—Ä", "–æ—Ç—Å–ª–µ–¥–∏—Ç—å", "—Å—Ç–∞—Ç—É—Å"
   ],
    en: ["hello", "shipping", "payment", "product", "address", "card"],
    sk: ["ahoj", "doruƒçenie", "platba", "produkt", "adresa", "karta"]
  };
  
  function detectLanguage(text) {
  const scores = { ru: 0, en: 0, sk: 0 };

  for (const [userLang, keywords] of Object.entries(languageKeywords)) {
    for (const keyword of keywords) {
      if (text.includes(keyword)) scores[userLang]++;
    }
  }

  const detected = Object.entries(scores).sort((a, b) => b[1] - a[1])[0];
  return detected[1] > 0 ? detected[0] : "en"; // fallback –Ω–∞ –∞–Ω–≥–ª–∏–π—Å–∫–∏–π
}
  let trackingAwait = false;
        function retryTracking(userLang) {
          trackingAwait = true;

          const messages = document.getElementById('messages');
          const promptText = {
            ru: "üì¶ –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –≤–∞—à —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä:",
            en: "üì¶ Please enter your tracking number:",
            sk: "üì¶ Zadajte svoje sledovacie ƒç√≠slo:"
          };

          messages.innerHTML += `<div class="message bot">${promptText[userLang]}</div>`;
          messages.scrollTop = messages.scrollHeight;
        }
  function handleTrackingNumber(trackNum, userLang) {
    fetch(`https://script.google.com/macros/s/AKfycbwjzu2NBbhHVZ_pqxI2QXBAFPUfbcxAxzVh6rsrxveiMClc1P9cfcSUE-ZazY8l7m2R/exec?track=${trackNum}`)
      .then(res => res.json())
      .then(data => {
        let reply;
        if (data.error) {
          const retryText = {
            ru: "‚ö† –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∑–∞–∫–∞–∑ —Å —Ç–∞–∫–∏–º –Ω–æ–º–µ—Ä–æ–º. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏ –ø–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.",
            en: "‚ö† Order not found. Please check the number and try again.",
            sk: "‚ö† Objedn√°vku s t√Ωmto ƒç√≠slom sa nepodarilo n√°js≈•. Sk√∫ste to znova."
          };
          
          reply = `${retryText[userLang]}<br><br><button onclick="retryTracking('${userLang}')" style="margin-top:10px;padding:5px 10px;">üîÅ ${userLang === "ru" ? "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å" : userLang === "sk" ? "Zopakova≈•" : "Retry"}</button>`;
        } else {
          reply = `üì¶ –°—Ç–∞—Ç—É—Å –∑–∞–∫–∞–∑–∞ ${data.track}: <b>${data.status}</b><br>üóì –û–±–Ω–æ–≤–ª–µ–Ω–æ: ${data.date}<br>üí¨ –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${data.comment}`;
        }

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º ¬´–ø–µ—á–∞—Ç–∞–µ—Ç¬ª
        const messages = document.getElementById('messages');
        const typingTexts = {
          ru: "ü§ñ –ë–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...",
          en: "ü§ñ Bot is typing...",
          sk: "ü§ñ Bot p√≠≈°e..."
        };
        messages.innerHTML += `<div class="message bot typing">${typingTexts[userLang]}</div>`;
        messages.scrollTop = messages.scrollHeight;

        setTimeout(() => {
          document.querySelector('.typing')?.remove();
          messages.innerHTML += `<div class="message bot">${reply}</div>`;
          messages.scrollTop = messages.scrollHeight;
        }, 700);
      });
  }

  function sendMessage() {
    const rawInput = document.getElementById('userInput').value.trim();
    if (!rawInput) return;

    const userMsg = preprocess(rawInput);
    if (!userLang) {
      userLang = detectLanguage(userMsg);
    }
    const lastIntentSession = sessionStorage.getItem("lastIntent");
    const messages = document.getElementById('messages');

    let reply = botReplies[userLang].answers.unknown;

    // –û—Ç–æ–±—Ä–∞–∂–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    messages.innerHTML += `<div class="message user">${rawInput}</div>`;
    document.getElementById('userInput').value = "";

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —Ç—Ä–µ–∫-–Ω–æ–º–µ—Ä–∞
    if (trackingAwait) {
      trackingAwait = false;
      handleTrackingNumber(rawInput, userLang);
      return;
    }

    // –û–±—Ä–∞–±–æ—Ç–∫–∞ —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–æ—Å–ª–µ "–¥–æ—Å—Ç–∞–≤–∫–∞"
    if (lastIntentSession === "shipping") {
      if (userMsg.includes("–∫–∞–∑–∞—Ö—Å—Ç–∞–Ω")) {
        reply = botReplies[userLang].answers["shippingkz"];
      } else if (userMsg.includes("—Ä–æ—Å—Å–∏")) {
        reply = botReplies[userLang].answers["shippingsng"];
      } else if (userMsg.includes("—Å–ª–æ–≤–∞–∫")) {
        reply = botReplies[userLang].answers["shippingsk"];
      }

      if (reply !== botReplies[userLang].answers.unknown) {
        showBotReply(reply, userLang);
        return;
      }
    }

    // –ü–ª–æ—Ö–∏–µ —Å–ª–æ–≤–∞
    let foundBad = false;
    let badLang = userLang;

    for (const [lang, words] of Object.entries(badWords)) {
      if (words.some(word => userMsg.includes(word))) {
        foundBad = true;
        badLang = lang; // –æ–ø—Ä–µ–¥–µ–ª—è–µ–º, –Ω–∞ –∫–∞–∫–æ–º —è–∑—ã–∫–µ –±—ã–ª–∞ –≥—Ä—É–±–æ—Å—Ç—å
        break;
      }
    }

    if (foundBad) {
      const badReplies = {
        ru: "‚ö† –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–µ–∂–ª–∏–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è.",
        en: "‚ö† Please use polite expressions.",
        sk: "‚ö† Pros√≠m, pou≈æ√≠vajte slu≈°n√© v√Ωrazy."
      };
      reply = badReplies[badLang] || badReplies["en"];
      showBotReply(reply, userLang, "red");
      return;
    }

    // –ü–æ–∏—Å–∫ –∏–Ω—Ç–µ–Ω—Ç–æ–≤
    let detectedIntents = [];
    for (const intent of intents) {
      let score = 0;
      for (const pattern of intent.patterns) {
        if (userMsg.includes(pattern)) score++;
      }
      if (score > 0) detectedIntents.push({ intent, score });
    }

    detectedIntents.sort((a, b) => b.score - a.score);
    const priorityIntent = detectedIntents.find(d => d.intent.name === "trackingRequest");
    if (priorityIntent) {
      detectedIntents = [priorityIntent];
    }

    lastIntent = detectedIntents[0]?.intent.name || null;
    sessionStorage.setItem("lastIntent", lastIntent);

    if (detectedIntents.length > 0) {
      if (detectedIntents.length > 1) {
        reply = "–í—ã —Å–ø—Ä–∞—à–∏–≤–∞–µ—Ç–µ —Å—Ä–∞–∑—É –æ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –≤–µ—â–∞—Ö:";
        for (const { intent } of detectedIntents.slice(0, 3)) {
          const answer = botReplies[userLang].answers[intent.responseKey];
          reply += `<br><br><b>‚Ä¢ ${intent.name}:</b><br>${answer}`;
        }
      } else {
        const intent = detectedIntents[0].intent;
        reply = botReplies[userLang].answers[intent.responseKey];

        if (intent.responseKey === "tracking" || intent.responseKey === "trackingRequest") {
          trackingAwait = true;
          reply = botReplies[userLang].answers.trackingRequest;
        }
      }
    } else {
      // fallback
      reply += "<br><br>ü§ñ –Ø –Ω–µ –¥–æ –∫–æ–Ω—Ü–∞ –ø–æ–Ω—è–ª –≤–∞—à –≤–æ–ø—Ä–æ—Å. –í–æ—Ç —Å —á–µ–º –º–æ–≥—É –ø–æ–º–æ—á—å:<br>üëâ –¥–æ—Å—Ç–∞–≤–∫–∞, –æ–ø–ª–∞—Ç–∞, –≤–æ–∑–≤—Ä–∞—Ç, –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ<br><br>üì© –ò–ª–∏ –Ω–∞–ø–∏—à–∏—Ç–µ: <a href='mailto:thread.novacustom@gmail.com'>thread.novacustom@gmail.com</a>";
    }

    showBotReply(reply, userLang);
  }

  function showBotReply(reply, userLang, color = null) {
    const messages = document.getElementById('messages');
    const typingText = {
      ru: "ü§ñ –ë–æ—Ç –ø–µ—á–∞—Ç–∞–µ—Ç...",
      en: "ü§ñ Bot is typing...",
      sk: "ü§ñ Bot p√≠≈°e..."
    };

    messages.innerHTML += `<div class="message bot typing">${typingText[userLang]}</div>`;
    messages.scrollTop = messages.scrollHeight;

    setTimeout(() => {
      document.querySelector('.typing')?.remove();
      messages.innerHTML += `<div class="message bot" ${color ? `style="color:${color};"` : ""}>${reply}</div>`;
      messages.scrollTop = messages.scrollHeight;
    }, 700);
  }

    messages.scrollTop = messages.scrollHeight;

document.getElementById('sendBtn').addEventListener('click', sendMessage);
document.getElementById("userInput").addEventListener("keydown", function (e) {
  if (e.key === "Enter") sendMessage();
});

window.retryTracking = retryTracking;

  </script>
</body>
</html>